# 底盘系统辨识快速参考卡 🎯

> 一页纸速查手册

## 🚀 三步快速开始

### 1️⃣ 配置Ozone记录（1分钟）
```
添加变量（1kHz采样）：
  sysid_data.time_elapsed
  sysid_data.step_input
  sysid_data.motor_output
```

### 2️⃣ 启动测试（20秒）
```c
// 触发辨识
Chassis_SysID_Ctrl_Cmd_s cmd = {.enable = 1, .target_motor = 0};
// 发布到 "chassis_sysid_cmd"

// 等待20秒，导出CSV
```

### 3️⃣ MATLAB计算（3分钟）
```matlab
cd Chassis
Chassis_Wheel_SysID
% 选择CSV → 选择区间 → 复制输出代码
```

---

## 📊 关键参数

### 测试参数（sysid_task.c）

| 参数 | 默认值 | 调整建议 |
|------|--------|----------|
| `STEP_AMPLITUDE` | 5000 | 太小→6000, 太大→4000 |
| `STEP_INTERVAL` | 2.0s | 稳定慢→3.0s |
| `TOTAL_DURATION` | 20.0s | 至少10个阶跃周期 |
| `TARGET_MOTOR` | 0(lf) | 0-lf, 1-rf, 2-lb, 3-rb |

### 物理参数（已定义）

| 参数 | 值 | 位置 |
|------|-----|------|
| Kt | 0.3 N·m/A | robot_def.h |
| GearRatio | 19.0 | robot_def.h |
| r_wheel | 0.077 m | robot_def.h |
| M_chassis | 17.0 kg | robot_def.h |

---

## 📈 输出解读

### MATLAB输出示例
```
辨识物理参数（单轮）:
  J_eff = 0.001180 kg·m²     ← 单轮惯量
  b_eff = 0.014450 N·m·s/rad ← 单轮阻尼
  拟合度 = 91.2%             ← 质量指标

推算整车阻尼:
  b_linear ≈ 16.85 N·s/m    ← 用于LQR计算
  b_angular ≈ 2.34 N·m·s/rad

LQR增益:
  K_velocity = 147.30 N/(m/s)  ← 复制到代码
  K_velocity = 49.80 N·m/(rad/s)
```

### 合理性检查

✅ **拟合度**：>85% 优秀，70-85% 良好，<70% 重测  
✅ **J_eff**：应在 0.0008~0.0020 kg·m²  
✅ **b_linear**：应在 10~25 N·s/m  
✅ **K_velocity**：应在 80~250 N/(m/s)

---

## ⚠️ 故障速查

| 问题 | 原因 | 解决 |
|------|------|------|
| 电机不转 | 未使能 | 检查enable=1 |
| 拟合度<50% | 数据差 | 重新选区间，选稳态段 |
| K值异常大 | 单位错误 | 检查CSV列是rad/s |
| 四轮都在转 | 配置错误 | 检查ConfigMotors()函数 |

---

## 🔄 数据区间选择

### 推荐选择
```
完整测试数据：
├── 0-2s    ↓ 跳过（启动瞬态）
├── 2-4s    
├── 4-6s    ✓ 选择开始
├── 6-8s    ✓
├── 8-10s   ✓
├── 10-12s  ✓
├── 12-14s  ✓ 选择结束
├── 14-16s  
├── 16-18s  ↓ 跳过（末尾可能减速）
└── 18-20s
```

**原则**：
- 跳过前2个周期
- 跳过后2个周期
- 选中间5-6个完整周期

---

## 💻 代码集成

### 复制MATLAB输出到这里：

**位置**：`Chassis/application/chassis/chassis.c` → `ChassisInit()` → 第227-265行

**替换内容**：
```c
LQR_Velocity_Init_Config_s force_x_lqr_config = {
    .K_velocity = [MATLAB输出值],  // ← 改这里
    .K_integral = [MATLAB输出值],  // ← 改这里
    // ... 其他保持不变
};
```

**完整代码**：见MATLAB脚本输出（可直接复制粘贴）

---

## 📋 快速检查表

**测试前**：
- [ ] Ozone已配置记录变量
- [ ] 目标电机已设置
- [ ] 底盘放置稳定
- [ ] 其他轮子不干扰

**测试中**：
- [ ] 目标轮在转动（2秒正反切换）
- [ ] Ozone正在记录
- [ ] 数据曲线正常

**测试后**：
- [ ] 已导出CSV
- [ ] 拟合度>70%
- [ ] 参数合理性检查通过
- [ ] 已复制代码到chassis.c
- [ ] 已编译测试

---

## 🎯 性能目标

使用辨识参数后应达到：

| 指标 | 目标 |
|------|------|
| 上升时间 | < 150 ms |
| 超调量 | < 10% |
| 稳态误差 | < 2 cm |
| 低速平滑 | 无抖动 |

如未达到 → 查看"底盘LQR力控使用指南.md"的调试章节

---

## 📞 快速帮助

**问题** → **查看文档** → **章节**

拟合度低 → 底盘系统辨识完整流程.md → 步骤3数据选择  
K值不知道对不对 → 本文档 → 输出解读  
不知道怎么触发 → 底盘系统辨识完整流程.md → 步骤2  
MATLAB报错 → 本文档 → 故障速查表  

---

## 🔗 文档链接

- 📖 完整教程：`底盘系统辨识完整流程.md`
- 🔧 任务说明：`application/sysid/sysid_task.md`
- 💻 MATLAB脚本：`Chassis_Wheel_SysID.m`
- 🎯 LQR教程：`底盘LQR力控使用指南.md`

---

**提示**：第一次使用请看"底盘系统辨识完整流程.md"  
**快速参考**：熟悉流程后使用本文档

**祝辨识顺利！** ⚡

